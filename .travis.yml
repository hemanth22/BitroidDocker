language: bash

env:
  - container_id=${container_id:-$timestamp}
 
services:
  - docker
  
stages:
  - test
  - deploy

jobs:
  include:
    - stage: test
      script:
        - export container_id=$(date +%s)
        - export cleanup=false
        - docker swarm init
        - docker stack deploy -c stackfile.yml bitroid
        - sleep 90
        - docker service ps bitroid_app
        - docker service ls
        - echo "Listing files"
        - ls -la
        - wget -O- localhost:8080
    
    - stage: deploy
      script: ${DOCKER_HUB_TRIGGER}
      
notifications:
 slack:
   rooms:
     - nothingorganization:GN1JzklSpbMyfZVWcS05U6a0#mygitrepos
